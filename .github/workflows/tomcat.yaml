name: ci/cd pipeline to deploy to java application on tomcat
on: 
  push:
    branches: master
jobs:
  build-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: checkout code
        uses: actions/checkout@v3
      
      - name: set-up jdk
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'   # Updated Java version
      - name: validate and package with maven
        run: mvn clean package
      - name: verify WAR file
        run: ls -lh target/
      
      # - name: Build, Test and SonarQube Scan
      #   run: |
      #     mvn clean verify sonar:sonar \
      #       -Dsonar.projectKey=vcube139 \
      #       -Dsonar.host.url="${{ secrets.SONAR_HOST_URL }}" \
      #       -Dsonar.login="${{ secrets.SONAR_TOKEN }}"


      - name: deploy to tomcat server
        run: |
                curl -v -u ${{ secrets.TOMCAT_USER }}:${{ secrets.TOMCAT_PASSWORD }} \ 
                -T target/TrainBook-1.0.0-SNAPSHOT.war \
                "http://${{ secrets.TOMCAT_HOST }}:8080/manager/text/deploy?path=/kp&update=true"
